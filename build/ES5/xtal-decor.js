import{XtalDeco}from"./xtal-deco.js";import{define}from"./node_modules/xtal-latx/define.js";import{XtallatX}from"./node_modules/xtal-latx/xtal-latx.js";import{cd}from"./node_modules/xtal-shell/cd.js";export function qsa(css,from){return[].slice.call((from?from:this).querySelectorAll(css))}var into_next_element="into-next-element",import_template="import-template",attach_script="attach-script";export var XtalDecor=function(_XtallatX){babelHelpers.inherits(XtalDecor,_XtallatX);function XtalDecor(){babelHelpers.classCallCheck(this,XtalDecor);return babelHelpers.possibleConstructorReturn(this,(XtalDecor.__proto__||Object.getPrototypeOf(XtalDecor)).apply(this,arguments))}babelHelpers.createClass(XtalDecor,[{key:"attributeChangedCallback",value:function attributeChangedCallback(name,oldVal,newVal){babelHelpers.get(XtalDecor.prototype.__proto__||Object.getPrototypeOf(XtalDecor.prototype),"attributeChangedCallback",this).call(this,name,oldVal,newVal);switch(name){case import_template:this._importTemplate=null!==newVal;break;case attach_script:this._attachScript=null!==newVal;break;case into_next_element:this._intoNextElement=null!==newVal;break;}this.onDecoPropsChange()}},{key:"connectedCallback",value:function connectedCallback(){this._upgradeProperties(["disabled","attachScript","importTemplate","intoNextElement","whereCSSMatches"]);this._connected=!0;this.onDecoPropsChange();this.addMutationObserver()}},{key:"disconnectedCallback",value:function disconnectedCallback(){if(this._mutationObserver)this._mutationObserver.disconnect()}},{key:"do",value:function _do(){this.appendTemplates();this.attachScripts()}},{key:"addMutationObserver",value:function addMutationObserver(){var _this=this;this._mutationObserver=new MutationObserver(function(){_this.getTemplatesAndScripts();_this.do()});this.getTemplatesAndScripts();this.do();this._mutationObserver.observe(this,{childList:!0})}},{key:"getTemplatesAndScripts",value:function getTemplatesAndScripts(){this._templates=qsa("template",this);this._scripts=qsa("script",this)}},{key:"onDecoPropsChange",value:function onDecoPropsChange(){if(!this._connected||this.disabled)return;if(this._intoNextElement&&!this._nextSibling){this.getElement("_nextSibling",function(t){return t.nextElementSibling});return}this.do()}},{key:"appendTemplates",value:function appendTemplates(target){var _this2=this;if(!this._templates)return;if(!target&&this._intoNextElement)target=this._nextSibling;if(this._importTemplate&&target){customElements.whenDefined(target.tagName.toLowerCase()).then(function(){_this2._templates.forEach(function(template){if(template.dataset.xtalTemplInserted)return;var subTarget=target,path=template.dataset.path;if(path){subTarget=cd(target,path)}var clone=document.importNode(template.content,!0);subTarget.shadowRoot.appendChild(clone);template.dataset.xtalTemplInserted="true"})})}}},{key:"doScripts",value:function doScripts(target){var _this3=this;this._scripts.forEach(function(script){if(script.dataset.xtalScriptAttached)return;var subTarget=target,path=script.dataset.path;if(path){subTarget=cd(target,path)}_this3.evaluateCode(script,subTarget)})}},{key:"attachScripts",value:function attachScripts(target){var _this4=this;if(!this._scripts)return;if(!target&&this._intoNextElement)target=this._nextSibling;if(this._attachScript&&target){var ln=target.localName;if(-1<ln.indexOf("-")){customElements.whenDefined(target.tagName.toLowerCase()).then(function(){_this4.doScripts(target)})}else{this.doScripts(target)}}}},{key:"intoNextElement",get:function get(){return this._intoNextElement},set:function set(val){this.attr(into_next_element,val,"")}},{key:"importTemplate",get:function get(){return this._importTemplate},set:function set(val){this.attr(import_template,val,"")}},{key:"attachScript",get:function get(){return this._attachScript},set:function set(val){this.attr(attach_script,val,"")}}],[{key:"is",get:function get(){return"xtal-decor"}},{key:"observedAttributes",get:function get(){return babelHelpers.get(XtalDecor.__proto__||Object.getPrototypeOf(XtalDecor),"observedAttributes",this).concat([into_next_element,import_template,attach_script])}}]);return XtalDecor}(XtallatX(XtalDeco));XtalDecor._addedNodeInsertionStyle=!1;define(XtalDecor);