(function(){var XtalDecorator=function(_HTMLElement){babelHelpers.inherits(XtalDecorator,_HTMLElement);function XtalDecorator(){var _this;babelHelpers.classCallCheck(this,XtalDecorator);_this=babelHelpers.possibleConstructorReturn(this,(XtalDecorator.__proto__||Object.getPrototypeOf(XtalDecorator)).apply(this,arguments));_this._CssSelector="dom-bind";_this._minElementCount=1;_this._retries=0;return _this}babelHelpers.createClass(XtalDecorator,[{key:"attributeChangedCallback",value:function attributeChangedCallback(name,oldValue,newValue){switch(name){case"selector":this._CssSelector=newValue;break;case"min-element-count":this._minElementCount=parseInt(newValue);break;case"validate-targets":this._validateTargets=null!==newValue;break;}}},{key:"disconnectedCallback",value:function disconnectedCallback(){this._domObserver.disconnect()}},{key:"getShadowSubTargets",value:function getShadowSubTargets(targets,selector){var newTargets=[];targets.forEach(function(target){var shadowRoot=target.shadowRoot;if(!shadowRoot)return;var targets1=shadowRoot.querySelectorAll(selector),childTargets=[].slice.call(targets1);childTargets.forEach(function(childTarget){return newTargets.push(childTarget)})});return newTargets}},{key:"getHost",value:function getHost(){var parentElement=this.parentElement;while(parentElement){if(parentElement.shadowRoot)return parentElement;parentElement=parentElement.parentElement}}},{key:"getTargets",value:function getTargets(){switch(this._CssSelector){case"_host":var host=this.getHost();return host?[host]:null;default:for(var shadowSplitSelector=this._CssSelector.split(">>>"),targets=[].slice.call(this.parentElement.querySelectorAll(shadowSplitSelector[0])),i=1,ii=shadowSplitSelector.length;i<ii;i++){targets=this.getShadowSubTargets(targets,shadowSplitSelector[i])}return targets;}}},{key:"applyScript",value:function applyScript(scriptTag,targets){var _this2=this;if(!scriptTag)return;var innerText=scriptTag.innerText;if(innerText===this._previousEvaluatedText)return;var objectsToMerge=eval(innerText);this._previousEvaluatedText=innerText;for(var propertiesToSet,j=0,jj=objectsToMerge.length;j<jj;j++){var objectToMerge=objectsToMerge[j],_loop=function(){var val=objectToMerge[key];switch(babelHelpers.typeof(val)){case"function":targets.forEach(function(target){Object.defineProperty(target,key,{enumerable:!1,configurable:!0,writable:!0,value:val})});break;case"object":switch(key){case"style":var _loop2=function(_key){targets.forEach(function(target){target.style[_key]=val[_key]})};for(var _key in val){_loop2(_key)}break;case"properties":if(!propertiesToSet){propertiesToSet=val}else{_this2.mergeDeep(propertiesToSet,val)}break;case"polymerProperties":if(!propertiesToSet)propertiesToSet={};var _loop3=function(_key2){var polyProp=val[_key2];if(polyProp.value!==void 0){propertiesToSet[_key2]=polyProp.value}if(polyProp.observer!==void 0){targets.forEach(function(target){customElements.whenDefined(target.tagName.toLowerCase()).then(function(){if(target._createPropertyObserver){target._createPropertyObserver(_key2,polyProp.observer,!0)}})})}};for(var _key2 in val){_loop3(_key2)}break;}break;}};for(var key in objectToMerge){_loop()}}targets.forEach(function(target){if(target.setProperties){target.setProperties(propertiesToSet)}else{Object.assign(target,propertiesToSet)}})}},{key:"applyStyle",value:function applyStyle(styleTag,targets){if(!styleTag)return;targets.forEach(function(target){if(target.shadowRoot){var cn=styleTag.cloneNode(!0);target.shadowRoot.appendChild(cn)}})}},{key:"waitForLater",value:function waitForLater(){var _this3=this;this._retries++;if(100<this._retries){console.error("XtalDecorator::waitForLater:  "+"Could not find the right targets "+this._CssSelector);return}setTimeout(function(){_this3.evaluateCode()},100)}},{key:"evaluateCode",value:function evaluateCode(){if(this._validateTargets&&!this._targetValidator){this.waitForLater();return}var targets=this.getTargets();if(!targets||targets.length<this._minElementCount){this.waitForLater();return}if(this._targetValidator){if(!this._targetValidator(targets,this)){this.waitForLater();return}}var templateTag=this.querySelector("template"),clone;if(templateTag){clone=document.importNode(templateTag.content,!0)}var scriptTag=this.querySelector("script");if(!scriptTag&&clone){scriptTag=clone.querySelector("script")}var styleTag=this.querySelector("style");if(!styleTag&&clone){styleTag=clone.querySelector("style")}if(!scriptTag&&!styleTag){console.error("XtalDecorator::evaluateCode:  "+"No script tag or style tag found to apply."+this._CssSelector);return}this.applyScript(scriptTag,targets);this.applyStyle(styleTag,targets)}},{key:"connectedCallback",value:function connectedCallback(){this.evaluateCode()}},{key:"mergeDeep",value:function mergeDeep(target,source){var _this4=this;if("object"!==babelHelpers.typeof(target))return;if("object"!==babelHelpers.typeof(source))return;for(var key in source){var sourceVal=source[key],targetVal=target[key];if(!sourceVal)continue;if(!targetVal){target[key]=sourceVal;continue}if(Array.isArray(sourceVal)&&Array.isArray(targetVal)){if(0<targetVal.length&&"undefined"===typeof targetVal[0].id)continue;for(var _loop4=function(){var srcEl=sourceVal[i];if("undefined"===typeof srcEl.id)return"continue";var targetEl=targetVal.find(function(el){return el.id===srcEl.id});if(targetEl){_this4.mergeDeep(targetEl,srcEl)}else{targetVal.push(srcEl)}},i=0,ii=sourceVal.length,_ret;i<ii;i++){_ret=_loop4();if("continue"===_ret)continue}continue}switch(babelHelpers.typeof(sourceVal)){case"object":switch(babelHelpers.typeof(targetVal)){case"object":this.mergeDeep(targetVal,sourceVal);break;default:target[key]=sourceVal;break;}break;default:target[key]=sourceVal;}}return target}},{key:"validateTargets",set:function set(val){if(val){this.setAttribute("validate-targets","")}else{this.removeAttribute("validate-targets")}}},{key:"targetValidator",set:function set(val){this._targetValidator=val}}],[{key:"is",get:function get(){return"xtal-decorator"}},{key:"observedAttributes",get:function get(){return["selector","min-element-count","validate-targets"]}}]);return XtalDecorator}(HTMLElement);customElements.define(XtalDecorator.is,XtalDecorator)})();